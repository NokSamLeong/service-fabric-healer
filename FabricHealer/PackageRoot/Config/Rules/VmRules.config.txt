## Logic rules for Virtual Machine level repairs in the cluster. Only OS reboot is supported today.

## First, check if we are inside run interval. If so, then cut (!).
Mitigate() :- CheckInsideRunInterval(RunInterval=02:00:00), !.

Mitigate(MetricName="MemoryPercent", MetricValue=?MetricValue) :- ?MetricValue >= 90,
	GetRepairHistory(?repairCount, TimeWindow=08:00:00), 
	?repairCount < 4,
    RestartVM().

## This rule - and metric - does not apply to Windows. Only Linux FO will emit warnings related to system-wide file handle abuse.
Mitigate(MetricName="FileHandlesPercent", MetricValue=?MetricValue) :- ?MetricValue >= 95,
	GetRepairHistory(?repairCount, TimeWindow=08:00:00), 
	?repairCount < 2,
    RestartVM().