## Logic rules for Virtual Machine level repairs in the cluster. Only OS reboot is supported today.

## First, check if we are inside run interval. If so, then cut (!).
Mitigate() :- CheckInsideRunInterval(RunInterval=02:00:00), !.

## Percent Memory in Use (of total physical).
Mitigate(MetricName="MemoryPercent", MetricValue=?MetricValue) :- ?MetricValue >= 95,
	GetRepairHistory(?repairCount, TimeWindow=08:00:00), 
	?repairCount < 4,
    	RestartVM().

## File Handles/FDs.
## Percent Allocated, System-wide.
Mitigate(OS="Linux", MetricName="FileHandlesPercent", MetricValue=?MetricValue) :- ?MetricValue >= 95,
	GetRepairHistory(?repairCount, TimeWindow=08:00:00), 
	?repairCount < 2,
    	RestartVM().

## Total Allocated, System-wide.
Mitigate(OS="Linux", MetricName="FileHandles", MetricValue=?MetricValue) :- ?MetricValue >= 1000000,
	GetRepairHistory(?repairCount, TimeWindow=08:00:00), 
	?repairCount < 2,
    	RestartVM().
